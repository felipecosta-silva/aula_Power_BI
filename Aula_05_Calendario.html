<!DOCTYPE html>
<html lang="pt-BR" id="top">

<head>
  <meta charset="UTF-8" />
  <title>Aula 5 - Tabela Calend√°rio no Power BI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer" />

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
    integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer" />

  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <button class="hamburger-menu" id="hamburger-menu">
    ‚ò∞
  </button>

  <div class="sidebar" id="sidebar">
    <button class="sidebar-toggle-btn" id="sidebar-toggle-btn">
      <i class="fas fa-chevron-left"></i>
    </button>

    <h2><span class="sidebar-title-text">Power BI </span></h2>

    <a href="index.html"><i class="fas fa-home"></i> <span>In√≠cio Power BI</span></a>
    <a href="Introducao_BI_e_Power_BI.html"><i class="fas fa-rocket"></i> <span>Aula 1: Intro BI</span></a>
    <a href="Aula_02_Modelagem.html"><i class="fas fa-project-diagram"></i> <span>Aula 2: Modelagem</span></a>
    <a href="Aula_03_Criacao_Relacionamento.html"><i class="fas fa-sitemap"></i> <span>Aula 3:
        Relacionamentos</span></a>
    <a href="Aula_04_Acrescentar_Consultas.html"><i class="fas fa-layer-group"></i> <span>Aula 4: Acrescentar
        Consultas</span></a>
    <a href="Aula_05_Calendario.html" class="active"><i class="fas fa-calendar-alt"></i> <span>Aula 5: Tabela
        Calend√°rio</span></a>
    <a href="Aula_06_Resolucao_Exercicio_Funcionario.html" ><i class="fas fa-chart-line"></i> <span>Aula 6: Resolu√ß√£o Ex√©rc√≠cio Funcionarios</span></a>
    <a href="Aula_07_Gr√°ficos de Vendas e Introdu√ß√£o ao DAX.html" ><i class="fas fa-chart-line"></i> <span>Aula 7: Gr√°ficos de Vendas e Introdu√ß√£o ao DAX</span></a>
  </div>

  <div class="content" id="content">
    <header>
      <h1>Aula 5 ‚Äì Tabela Calend√°rio no Power BI</h1>
      <p>
        Introdu√ß√£o √† tabela calend√°rio: por que ela √© obrigat√≥ria em qualquer modelo profissional
        e como cri√°-la da forma certa (DAX e Power Query).
      </p>
    </header>

    <main class="main-section">

      <!-- PENSAMENTO DO DIA -->
      <blockquote class="thought-of-the-day">
        <p>"Carregando cita√ß√£o..."</p>
        <cite>‚Äî</cite>
      </blockquote>

      <section class="sub-section" id="conceitos-calendario">
        <h2>1. O que todo iniciante PRECISA entender sobre Tabela Calend√°rio</h2>

        <p>
          A tabela calend√°rio √© um dos pilares de qualquer modelo de dados bem feito no Power BI.
          N√£o √© ‚Äús√≥ uma tabela de datas para filtrar‚Äù, ela √© a base para todos os c√°lculos de tempo
          (Time Intelligence) funcionarem corretamente.
        </p>

        <div class="card">
          <h4>1. Para que serve a tabela calend√°rio?</h4>
          <p>
            A maioria dos alunos acha que a tabela calend√°rio serve apenas para
            ‚Äúfiltrar datas‚Äù nos visuais. Mas, na pr√°tica, ela √© a respons√°vel por permitir que o
            Power BI entenda <strong>tempo</strong> de forma correta.
          </p>
          <p>√â gra√ßas √† tabela calend√°rio que voc√™ consegue fazer c√°lculos como:</p>
          <ul>
            <li>Total no m√™s atual</li>
            <li>Total no m√™s anterior</li>
            <li>Acumulado no ano (YTD)</li>
            <li>Comparar Ano x Ano (YoY)</li>
            <li>Comparar M√™s x M√™s (MoM)</li>
          </ul>
          <p>
            <strong>Sem uma boa tabela calend√°rio, essas fun√ß√µes simplesmente n√£o funcionam da forma esperada.</strong>
          </p>
        </div>

        <div class="card">
          <h4>2. A Tabela Calend√°rio deve ser DIMENS√ÉO (tabela mestra)</h4>
          <p>
            No modelo estrela, a tabela de calend√°rio √© uma <strong>dimens√£o</strong>.
            Isso significa que:
          </p>
          <ul>
            <li>Cada data aparece apenas uma vez.</li>
            <li>N√£o h√° repeti√ß√µes de datas.</li>
            <li>Ela fica no lado <strong>1</strong> dos relacionamentos (1 ‚Üí Muitos).</li>
          </ul>
          <p>
            Exemplo de relacionamento ideal:
          </p>
          <pre><code class="language-text">
Calendario[Date]   1  ‚Üí  BaseVendas[Data da Venda]   *
          </code></pre>
        </div>

        <div class="card">
          <h4>3. Nome da coluna principal</h4>
          <p>
            A coluna principal da tabela calend√°rio deve ter um nome claro, como:
            <strong>Date</strong>, <strong>Data</strong> ou algo semelhante.
          </p>
          <p>
            O Power BI reconhece automaticamente colunas de datas quando:
          </p>
          <ul>
            <li>O tipo da coluna √© <strong>Data</strong>;</li>
            <li>O nome da coluna claramente remete a data.</li>
          </ul>
          <p>
            Evite nomes confusos como:
            <code>DataVendaSistemaRFQ_2024</code>, especialmente para quem est√° come√ßando.
          </p>
        </div>

        <div class="card">
          <h4>4. Relacionamento sempre 1 ‚Üí Muitos</h4>
          <p>
            O relacionamento b√°sico √©:
          </p>
          <pre><code class="language-text">
Calendario[Date]   1  ‚Üí  BaseVendas[Data da Venda]   *
          </code></pre>
          <p>
            Isso garante:
          </p>
          <ul>
            <li>Filtros funcionando corretamente;</li>
            <li>Fun√ß√µes de Time Intelligence operando da forma certa;</li>
            <li>Segmenta√ß√µes de dados (slicers) confi√°veis.</li>
          </ul>
        </div>

        <div class="card">
          <h4>5. Nunca use a coluna de data da tabela fato diretamente</h4>
          <p>Evite usar diretamente:</p>
          <ul>
            <li><code>BaseVendas[Data da Venda]</code> em segmentadores;</li>
            <li><code>BaseVendas[Data da Venda]</code> em eixos de gr√°ficos;</li>
            <li><code>BaseVendas[Data da Venda]</code> em c√°lculos de Time Intelligence.</li>
          </ul>
          <p>
            üëâ Sempre utilize a tabela calend√°rio como refer√™ncia oficial de datas.
          </p>
        </div>

        <div class="card">
          <h4>6. Cuidado com <code>CALENDARAUTO()</code></h4>
          <p>
            A fun√ß√£o <code>CALENDARAUTO()</code> cria automaticamente um intervalo de datas com base em todas
            as tabelas do modelo. √â √∫til, mas:
          </p>
          <ul>
            <li>Pode pegar datas de teste (muito antigas ou irrelevantes);</li>
            <li>Pode incluir datas ‚Äúestranhas‚Äù geradas por valores nulos convertidos (ex.: 1899, 1900...);</li>
            <li>Pode criar um calend√°rio muito maior do que voc√™ realmente precisa.</li>
          </ul>
          <p>
            Use, mas com consci√™ncia.
          </p>
        </div>

        <div class="card">
          <h4>7. Ordena√ß√£o de m√™s (sempre d√° problema em quem est√° come√ßando)</h4>
          <p>
            Se voc√™ tiver uma coluna:
          </p>
          <pre><code class="language-text">
MesNome = "Janeiro", "Fevereiro", "Mar√ßo"...
          </code></pre>
          <p>
            Voc√™ precisa obrigatoriamente fazer:
          </p>
          <p>
            <strong>Modelagem ‚Üí Ordenar por coluna ‚Üí MesNumero</strong>
          </p>
          <p>
            Caso contr√°rio, o Power BI vai ordenar por ordem alfab√©tica:
            Abril, Agosto, Dezembro‚Ä¶
          </p>
        </div>

        <div class="card">
          <h4>8. Fun√ß√£o pr√°tica de cada coluna</h4>
          <p>Uma forma simples de explicar para iniciantes:</p>
          <ul>
            <li><strong>Ano</strong> ‚Üí agrupar valores por ano;</li>
            <li><strong>MesNumero</strong> ‚Üí ordenar os meses corretamente;</li>
            <li><strong>MesNome</strong> ‚Üí usar nos visuais (mais amig√°vel para o usu√°rio);</li>
            <li><strong>Ano-M√™s</strong> ‚Üí navega√ß√£o no tempo e eixos cont√≠nuos;</li>
            <li><strong>Trimestre</strong> ‚Üí an√°lises corporativas (Q1, Q2, Q3...);</li>
            <li><strong>Dia da Semana</strong> ‚Üí entender comportamento (ex.: pico de vendas no s√°bado);</li>
            <li><strong>√â Fim de Semana?</strong> ‚Üí separar dias √∫teis de finais de semana.</li>
          </ul>
        </div>

        <div class="card">
          <h4>9. Marcar como tabela de data</h4>
          <p>
            No Power BI, depois de criar a tabela calend√°rio, √© importante marcar como
            <strong>‚ÄúTabela de data‚Äù</strong>:
          </p>
          <ul>
            <li>Ferramentas de tabela ‚Üí Marcar como tabela de data;</li>
            <li>Selecionar a coluna oficial de data (geralmente <code>[Date]</code>).</li>
          </ul>
          <p>
            Isso ajuda o Power BI a entender que essa √© a tabela oficial de datas do modelo.
          </p>
        </div>

        <div class="card">
          <h4>10. Atualiza√ß√£o autom√°tica do calend√°rio</h4>
          <p>
            Quando o calend√°rio √© baseado no MIN e MAX das datas da tabela fato, ele se ajusta automaticamente
            √† medida que novas vendas chegam.
          </p>
          <p>
            Assim voc√™ evita:
          </p>
          <ul>
            <li>Falta de datas para relat√≥rios futuros;</li>
            <li>Datas sobrando sem necessidade.</li>
          </ul>
        </div>

        <div class="card">
          <h4>11. Semana ISO (vis√£o mais avan√ßada)</h4>
          <p>
            Em muitos cen√°rios (Europa, ind√∫stria, log√≠stica), a contagem de semana segue a
            <strong>Semana ISO</strong>:
          </p>
          <ul>
            <li>A semana come√ßa na segunda-feira;</li>
            <li>A semana 1 √© aquela que cont√©m o dia 4 de janeiro.</li>
          </ul>
          <p>Voc√™ pode mencionar isso como curiosidade e aprofundar depois.</p>
        </div>

        <div class="card">
          <h4>12. Use SEMPRE a tabela calend√°rio no modelo, n√£o na improvisa√ß√£o</h4>
          <p>Regras simples para iniciantes:</p>
          <ul>
            <li>Segmentadores ‚Üí sempre da tabela calend√°rio;</li>
            <li>Eixos de gr√°ficos ‚Üí sempre da tabela calend√°rio;</li>
            <li>Time Intelligence ‚Üí sempre usando a tabela calend√°rio.</li>
          </ul>
        </div>

        <div class="card">
          <h4>13. Modelo estrela e datas</h4>
          <p>Evite caminhos estranhos como:</p>
          <pre><code class="language-text">
Vendas ‚Üí Produto ‚Üí Categoria ‚Üí Calend√°rio
          </code></pre>
          <p>
            O correto √©:
          </p>
          <pre><code class="language-text">
Calend√°rio ‚Üí Vendas
          </code></pre>
        </div>

        <div class="card">
          <h4>14. Nunca crie mais de uma tabela calend√°rio</h4>
          <p>
            Ter duas tabelas de data no modelo quase sempre leva a:
          </p>
          <ul>
            <li>Relacionamentos amb√≠guos;</li>
            <li>Erros em medidas de tempo;</li>
            <li>Filtros inconsistentes e dif√≠ceis de entender.</li>
          </ul>
        </div>
      </section>

      <section class="sub-section" id="dax-calendario">
        <h2>2. Criando Tabela Calend√°rio via DAX</h2>

        <div class="card">
          <h4>2.1. Tabela calend√°rio est√°tica (intervalo fixo)</h4>
          <p>
            Exemplo cl√°ssico, onde voc√™ define manualmente as datas m√≠nima e m√°xima:
          </p>
          <pre><code class="language-dax">
Calendario =
CALENDAR ( DATE(2015, 1, 1), DATE(2030, 12, 31) )
          </code></pre>

          <p>
            E uma vers√£o mais completa, j√° com colunas derivadas:
          </p>
          <pre><code class="language-dax">
Calendario =
ADDCOLUMNS (
    CALENDAR ( DATE(2015,1,1), DATE(2030,12,31) ),
    "Ano", YEAR([Date]),
    "M√™s", MONTH([Date]),
    "Nome M√™s", FORMAT([Date], "MMMM"),
    "Ano-M√™s", FORMAT([Date], "YYYY-MM"),
    "Trimestre", "T" & FORMAT([Date], "Q"),
    "Dia", DAY([Date]),
    "Dia da Semana", WEEKDAY([Date], 2),
    "Nome Dia Semana", FORMAT([Date], "dddd")
)
          </code></pre>

          <p>
            ‚úîÔ∏è Bom para bases com per√≠odo muito bem definido.
            ‚ùå Se entrrem datas fora desse intervalo, voc√™ precisa
            alterar o DAX manualmente.
          </p>
        </div>

        <div class="card">
          <h4>2.2. Calend√°rio baseado em BaseVendas[Data da Venda]: Detalhando as Fun√ß√µes DAX</h4>
          <p>
            Vers√£o profissional: o calend√°rio se ajusta ao intervalo de dados da tabela fato. Para construir essa
            tabela, usamos a fun√ß√£o principal **CALENDAR** (que gera a coluna de datas) e a fun√ß√£o **ADDCOLUMNS** (que
            adiciona todas as colunas derivadas).
          </p>

          <p>
            Observe o detalhe de cada fun√ß√£o utilizada para criar as colunas de tempo:
          </p>

          <table>
            <thead>
              <tr>
                <th>Fun√ß√£o DAX</th>
                <th>Sintaxe e Par√¢metros Chave</th>
                <th>Prop√≥sito na Tabela Calend√°rio</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>CALENDAR</code></td>
                <td><code>CALENDAR( DataInicial, DataFinal )</code></td>
                <td>Cria uma tabela com uma √∫nica coluna chamada `Date`, contendo todas as datas entre as datas m√≠nima e
                  m√°xima fornecidas.</td>
              </tr>
              <tr>
                <td><code>ADDCOLUMNS</code></td>
                <td><code>ADDCOLUMNS( Tabela, "NomeColuna1", Express√£o1, ... )</code></td>
                <td>Pega a tabela gerada por `CALENDAR` e adiciona as colunas de tempo (Ano, M√™s, Dia, etc.) com base
                  nas express√µes.</td>
              </tr>
              <tr>
                <td><code>YEAR</code>, <code>MONTH</code>, <code>DAY</code></td>
                <td><code>YEAR( Data )</code></td>
                <td>Extraem o valor num√©rico exato (Ano, M√™s ou Dia) da coluna principal `[Date]`.</td>
              </tr>
              <tr>
                <td><code>WEEKDAY</code></td>
                <td><code>WEEKDAY( Data, TipoRetorno )</code></td>
                <td>Retorna um n√∫mero para o dia da semana. O segundo par√¢metro (**TipoRetorno**) √© crucial:
                  <ul>
                    <li>Tipo 1 (Omitido): Domingo = 1, S√°bado = 7.</li>
                    <li>**Tipo 2 (usado aqui): Segunda = 1, Domingo = 7.** (Mais comum em BI e neg√≥cios)</li>
                    <li>Tipo 3: Segunda = 0, Domingo = 6.</li>
                  </ul>
                </td>
              </tr>
              <tr>
                <td><code>FORMAT</code></td>
                <td><code>FORMAT( Valor, FormatoTexto )</code></td>
                <td>Converte um valor (como a data) em um formato de texto espec√≠fico (ex: nome do m√™s, nome do dia da
                  semana, ano-m√™s para ordena√ß√£o).
                  <ul>
                    <li>`"mmmm"`: Retorna o nome completo do m√™s (ex: Janeiro).</li>
                    <li>`"dddd"`: Retorna o nome completo do dia da semana (ex: Segunda-feira).</li>
                    <li>`"YYYY-MM"`: Retorna o ano e m√™s juntos, √∫til para eixos de gr√°ficos.</li>
                  </ul>
                </td>
              </tr>
              <tr>
                <td><code>IF</code></td>
                <td><code>IF( L√≥gica, ValorSeVerdadeiro, ValorSeFalso )</code></td>
                <td>Usada para criar colunas de indicadores Bin√°rios (Sim/N√£o). Ex: `IF ( [DiaSemanaNumero] > 5, 1, 0 )`
                  checa se o dia √© S√°bado ou Domingo e retorna 1 (Sim) ou 0 (N√£o).</td>
              </tr>
            </tbody>
          </table>

          <p>
            O c√≥digo DAX completo para o calend√°rio autom√°tico, baseado no intervalo da sua tabela `BaseVendas`:
          </p>
          <pre><code class="language-dax">
Calendario =
VAR MinData =
    MIN ( BaseVendas[Data da Venda] )
VAR MaxData =
    MAX ( BaseVendas[Data da Venda] )
RETURN
ADDCOLUMNS (
    CALENDAR ( MinData, MaxData ),
    "Ano", YEAR ( [Date] ),
    "MesNumero", MONTH ( [Date] ),
    "MesNome", FORMAT ( [Date], "mmmm" ),
    "Dia", DAY ( [Date] ),

    -- Dia da semana
    "DiaSemanaNumero", WEEKDAY ( [Date], 2 ),              -- 1 = segunda, 7 = domingo (Tipo 2)
    "DiaSemanaNome", FORMAT ( [Date], "dddd" ),

    -- Ano-M√™s (para ordena√ß√£o/segmenta√ß√£o)
    "AnoMesNumero", YEAR ( [Date] ) * 100 + MONTH ( [Date] ),
    "AnoMesTexto", FORMAT ( [Date], "YYYY-MM" ),
    "MesAnoTexto", FORMAT ( [Date], "MMMM/YYYY" ),

    -- Trimestre
    "TrimestreNumero", INT ( FORMAT ( [Date], "Q" ) ),
    "TrimestreTexto", "T" & FORMAT ( [Date], "Q" ) & " - " & YEAR ( [Date] ),

    -- Indicadores
    "EhFimDeSemana", IF ( WEEKDAY ( [Date], 2 ) > 5, 1, 0 ), -- S√°bado (6) e Domingo (7)
    "EhDiaUtil", IF ( WEEKDAY ( [Date], 2 ) <= 5, 1, 0 )    -- Segunda (1) a Sexta (5)
)
          </code></pre>

          <p>
            ‚úîÔ∏è Se chegarem novas vendas com datas maiores (ou menores),
            na pr√≥xima atualiza√ß√£o o calend√°rio ser√° expandido automaticamente.
          </p>
        </div>
      </section>

      <section class="sub-section" id="pq-calendario">
        <h2>3. Criando Tabela Calend√°rio no Power Query: Detalhando a Linguagem M</h2>

        <div class="card" id="pq-calendario-automacao">
          <h4>3.1. Entendendo os Componentes da Linguagem M (Power Query)</h4>
          <p>
            A linguagem M, utilizada no Power Query, possui tipos de dados espec√≠ficos, chamados de **Literais**, que
            s√£o essenciais na manipula√ß√£o de datas e tempo.
          </p>

          <table>
            <thead>
              <tr>
                <th>Componente M</th>
                <th>Sintaxe</th>
                <th>Prop√≥sito e Exemplo</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>**Data**</td>
                <td>`#date(Ano, M√™s, Dia)`</td>
                <td>Define uma data espec√≠fica. *Ex: `#date(2025, 1, 1)` (1¬∫ de Janeiro de 2025).*</td>
              </tr>
              <tr>
                <td>**Dura√ß√£o**</td>
                <td>`#duration(Dias, Horas, Minutos, Segundos)`</td>
                <td>Define um intervalo de tempo, n√£o um ponto fixo. Usado para contar passos ou diferen√ßas entre datas.
                  *Ex: `#duration(1, 0, 0, 0)` (exatamente 1 dia).*</td>
              </tr>
              <tr>
                <td>**Data e Hora**</td>
                <td>`#datetime(A, M, D, H, Min, S)`</td>
                <td>Define um ponto espec√≠fico no tempo, com detalhes de hora, minuto e segundo.</td>
              </tr>
            </tbody>
          </table>

          <h4>3.2. Criando o Calend√°rio Autom√°tico: Passo a Passo e Testes</h4>
          <p>
            O m√©todo mais robusto no Power Query envolve criar uma **Consulta Nula (Blank Query)** e definir as
            vari√°veis de data m√≠nima, data m√°xima, e o intervalo de dias de forma program√°tica.
          </p>

          <div class="step-by-step">
            <h5>Passo 1: Encontrando a Data M√≠nima (`DataMin`)</h5>
            <p>
              Em uma nova consulta nula, utilize a fun√ß√£o `List.Min` para encontrar a data mais antiga na coluna da sua
              tabela Fato (`fBaseVendas`).
              <br />
              **Aten√ß√£o:** A linguagem M √© **Case Sensitive** (sens√≠vel a mai√∫sculas/min√∫sculas). O nome da tabela e da
              coluna devem ser escritos **exatamente** como est√£o no Power Query (ex: `fBaseVendas[Data da Venda]`, e
              n√£o `fbasevendas[data da venda]`).
            </p>
            <pre><code class="language-powershell">
= List.Min(fBaseVendas[Data da Venda])
            </code></pre>
            <p>
              *Para ver o resultado:* Digite o c√≥digo acima na Barra de F√≥rmulas e aperte Enter. O resultado ser√° a data
              inicial do seu calend√°rio.
            </p>

            <h5>Passo 2: Inserindo e Renomeando a Etapa para a Data M√°xima (`DataMax`)</h5>
            <p>
              Para n√£o perder o resultado do `DataMin` e continuar a construir o calend√°rio na mesma consulta:
            <ol>
              <li>Na se√ß√£o **Etapas Aplicadas**, clique com o bot√£o direito na √∫ltima etapa (onde voc√™ definiu o
                `DataMin`) e escolha **"Inserir pr√≥xima etapa"**.</li>
              <li>Renomeie a nova etapa para `DataMax`.</li>
              <li>Na Barra de F√≥rmulas, utilize a fun√ß√£o `List.Max`.</li>
            </ol>
            </p>
            <pre><code class="language-powershell">
// Se voc√™ estivesse digitando no Editor Avan√ßado, seria assim:
DataMax = List.Max(fBaseVendas[Data da Venda]),
            </code></pre>
            <p>
              **Outra forma (Editor Avan√ßado):** Para maior clareza e controle, o m√©todo preferido √© usar o **Editor
              Avan√ßado** (Guia P√°gina Inicial) para definir todas as vari√°veis (`let... in`) de uma vez.
            </p>

            <h5>Passo 3: Calculando a Quantidade Total de Dias (`QtdDias`)</h5>
            <p>
              Precisamos saber o n√∫mero exato de dias entre a data m√≠nima e a m√°xima.
            </p>
            <pre><code class="language-powershell">
= Duration.Days(DataMax - DataMin) + 1
            </code></pre>
            <ul>
              <li>**`DataMax - DataMin`:** Subtrair datas retorna um valor de **Dura√ß√£o**.</li>
              <li>**`Duration.Days(...)`:** Transforma essa Dura√ß√£o em um n√∫mero inteiro de dias.</li>
              <li>**Por que o `+ 1`?** A diferen√ßa entre a data final e a inicial calcula apenas o **intervalo** entre
                elas. Para incluir a data inicial e a data final, √© necess√°rio adicionar **+ 1** ao resultado. (Ex: De
                01/01 a 03/01 a diferen√ßa √© 2 dias, mas a lista deve ter 3 datas: 01, 02 e 03).</li>
            </ul>

            <h5>Passo 4: Criando a Lista de Datas Cont√≠nuas (`List.Dates`)</h5>
            <p>
              A fun√ß√£o `List.Dates` √© utilizada para gerar a sequ√™ncia:
            </p>
            <pre><code class="language-powershell">
= List.Dates(DataMin, QtdDias, #duration(1,0,0,0))
            </code></pre>
            <ul>
              <li>**`DataMin`:** A data de in√≠cio da lista.</li>
              <li>**`QtdDias`:** O n√∫mero total de elementos que a lista deve conter (calculado no passo anterior).</li>
              <li>**`#duration(1,0,0,0)` (Step):** Define o **passo** (intervalo) entre as datas. O valor `(1, 0, 0, 0)`
                significa que o calend√°rio pular√° de 1 em 1 dia, garantindo a continuidade di√°ria.</li>
            </ul>

            <h5>Passo 5: Convertendo a Lista em Tabela e Renomeando</h5>
            <p>
              O resultado do `List.Dates` √© uma **Lista** (n√£o formatada como tabela). Para transform√°-la em uma tabela
              manipul√°vel, v√° na guia **Transformar** e clique em **Converter para Tabela** . Renomeie a coluna para
              **Datas** e altere o tipo para **Data**.
            </p>
          </div>

          <h4>3.3. Consolida√ß√£o no Editor Avan√ßado</h4>
          <p>
            O c√≥digo final para gerar a base da tabela calend√°rio √© consolidado no Editor Avan√ßado (P√°gina Inicial ‚Üí
            Editor Avan√ßado), garantindo que tudo seja feito em um √∫nico bloco de c√≥digo M:
          </p>

          <pre><code class="language-powershell">
let
    // 1. Defini√ß√£o das vari√°veis de in√≠cio e fim
    DataMin = List.Min(fBaseVendas[Data da Venda]),
    DataMax = List.Max(fBaseVendas[Data da Venda]),
    
    // 2. C√°lculo da quantidade de dias (incluindo o +1)
    QtdDias = Duration.Days(DataMax-DataMin)+1,
    
    // 3. Cria√ß√£o da lista de datas
    Personalizar1 = List.Dates(DataMin, QtdDias, #duration(1, 0, 0, 0)),
    
    // 4. Convers√£o para Tabela
    #"Convertido para Tabela" = Table.FromList(Personalizar1, Splitter.SplitByNothing(), null, null, ExtraValues.Error),
    
    // 5. Renomear e Alterar o Tipo
    #"Colunas Renomeadas" = Table.RenameColumns(#"Convertido para Tabela",{{"Column1", "Datas"}}),
    #"Tipo Alterado" = Table.TransformColumnTypes(#"Colunas Renomeadas",{{"Datas", type date}})
in
    #"Tipo Alterado"
          </code></pre>

          <h4>3.4. Adi√ß√£o R√°pida de Colunas Auxiliares</h4>
          <p>
            Em vez de escrever mais c√≥digo M, o Power Query oferece ferramentas visuais poderosas. Selecione a coluna
            **Datas**, v√° na guia **Adicionar Coluna**, e utilize as fun√ß√µes de data para criar rapidamente colunas
            auxiliares como Ano, M√™s, Nome do M√™s, Trimestre do Ano e Semana do Ano
          </p>
          <p>
            **Lembrete de Ordena√ß√£o:** Ap√≥s criar a tabela (seja por DAX ou Power Query), voc√™ sempre deve ir para a
            **Visualiza√ß√£o de Dados** no Power BI (n√£o no Power Query) e usar **Modelagem ‚Üí Ordenar por coluna** (Ex:
            Ordenar a coluna `Nome do M√™s` pela coluna `N√∫mero do M√™s`).
          </p>
        </div>

        <div class="card">
          <h4>3.5. Criando Colunas Personalizadas com L√≥gica Condicional</h4>

          <p>
            O menu de **Adicionar Coluna** tem muitas op√ß√µes prontas, mas e se voc√™ precisar de uma categoriza√ß√£o que
            n√£o existe por padr√£o, como **Semestre** ou **Porte da Loja**?
          </p>
          <p>
            √â para isso que usamos a **Coluna Condicional**, uma ferramenta visual do Power Query que permite criar
            l√≥gica `SE... ENT√ÉO... SEN√ÉO` (IF... THEN... ELSE) .
          </p>

          <h5>O Papel da Coluna Condicional e o Bloco "Sen√£o"</h5>
          <p>
            A **Coluna Condicional** √© utilizada para criar novas colunas de texto (categ√≥ricas) baseadas em uma ou mais
            condi√ß√µes l√≥gicas sobre colunas existentes.
            <br />
            No nosso caso, iremos utiliz√°-la para criar an√°lises de tempo que n√£o existem nas op√ß√µes padr√£o (como o
            <strong>Semestre</strong>), e para classificar dados num√©ricos em grupos (como o <strong>Ticket do
              Produto</strong>).
          </p>
          <p>
            O bloco **Sen√£o** (ou "Else" no c√≥digo M) √© fundamental. Ele define o valor padr√£o que a nova coluna ir√°
            receber se <strong>nenhuma</strong> das regras anteriores for satisfeita.
            <br />
            **Exemplo:** No caso do Semestre, se o m√™s n√£o for menor ou igual a 6 (Semestre 1), o bloco **Sen√£o**
            garante que ele seja automaticamente o Semestre 2, cobrindo todos os casos restantes (Meses 7, 8, 9, 10, 11
            e 12).
          </p>

          <h5>Caso Pr√°tico 1: Criando a Coluna "Semestre" (Tabela Calend√°rio)</h5>

          <p>
            Para adicionar uma an√°lise por semestre, algo que n√£o est√° dispon√≠vel nas op√ß√µes de data do Power Query,
            usamos a Coluna Condicional a partir da coluna `M√™s` (n√∫mero):
          </p>

          <ol>
            <li>Na guia **Adicionar Coluna**, clique em **Coluna Condicional**.</li>
            <li>**Nome da Coluna:** Digite `"Semestre"`.</li>
            <li>**Primeira Regra:**
              <ul>
                <li>**Nome da Coluna:** Selecione `Mes` (a coluna com o n√∫mero do m√™s).</li>
                <li>**Operador:** Escolha `√© menor ou igual a`.</li>
                <li>**Valor:** Digite `6`.</li>
                <li>**Sa√≠da:** Digite `"Semestre 1"`.</li>
              </ul>
            </li>
            <li>**Definindo o SEN√ÉO:**
              <ul>
                <li>**Sen√£o:** Digite `"Semestre 2"`.</li>
              </ul>
            </li>
          </ol>

          <p>
            **Resultado em c√≥digo M (Gerado Automaticamente):**
          </p>
          <pre><code class="language-powershell">
= Table.AddColumn(#"M√™s Inserido", "Semestre", each if [Mes] <= 6 then "Semestre 1" else "Semestre 2")
          </code></pre>

          <h5>Caso Pr√°tico 2: Criando a Coluna "Ticket do Produto" (Tabela Produtos)</h5>

          <p>
            Para classificar os produtos por faixas de pre√ßo (Ticket Baixo, M√©dio, Alto), utilizamos a coluna
            <code>Pre√ßo Unitario</code> da tabela de Produtos:
          </p>

          <ol>
            <li>Na tabela de Produtos, v√° em **Adicionar Coluna** e clique em **Coluna Condicional**.</li>
            <li>**Nome da Coluna:** Digite `"Ticket do Produto"`.</li>
            <li>**Primeira Condi√ß√£o (Ticket Baixo):**
              <ul>
                <li>**Nome da Coluna:** Selecione `Pre√ßo Unitario`.</li>
                <li>**Operador:** Escolha `√© menor ou igual a`.</li>
                <li>**Valor:** Digite `500`.</li>
                <li>**Sa√≠da:** Digite `"Ticket Baixo"`.</li>
              </ul>
            </li>
            <li>**Adicionar Cl√°usula (Ticket M√©dio):** Clique em **Adicionar Cl√°usula**.
              <ul>
                <li>**Nome da Coluna:** Selecione `Pre√ßo Unitario`.</li>
                <li>**Operador:** Escolha `√© menor ou igual a`.</li>
                <li>**Valor:** Digite `2000`.</li>
                <li>**Sa√≠da:** Digite `"Ticket M√©dio"`.</li>
              </ul>
            </li>
            <li>**Definindo o SEN√ÉO (Ticket Alto):**
              <p>
                Como √∫ltima condi√ß√£o (o Sen√£o), definimos que se o pre√ßo for maior que R$ 2000, ele ser√° "Ticket Alto".
              </p>
              <ul>
                <li>**Sen√£o:** Digite `"Ticket Alto"`.</li>
              </ul>
            </li>
          </ol>

          <p>
            **Resultado em c√≥digo M (Gerado Automaticamente):**
          </p>
          <pre><code class="language-powershell">
= Table.AddColumn(NomeDaEtapaAnterior, "Ticket do Produto", each if [Pre√ßo Unitario] <= 500 then "Ticket Baixo" else if [Pre√ßo Unitario] <= 2000 then "Ticket M√©dio" else "Ticket Alto")
          </code></pre>

          <h5>Outros Exemplos √öteis de Colunas Condicionais (An√°lise das Tabelas)</h5>
          <p>
            Com base na estrutura de dados das suas tabelas (Lojas e Clientes), podemos adicionar mais colunas
            condicionais para enriquecer a an√°lise:
          </p>
          <ul>
            <li>**Porte da Loja (Tabela Lojas):**
              <p>
                Classificando as lojas com base no n√∫mero de colaboradores (usando a coluna
                <code>Quantidade Colaboradores</code>):
              </p>
              <ul>
                <li>**Regra 1:** Se `Quantidade Colaboradores` `√© menor ou igual a` `10` ‚Üí Sa√≠da: `"Pequena"`.</li>
                <li>**Regra 2:** Se `Quantidade Colaboradores` `√© menor ou igual a` `50` ‚Üí Sa√≠da: `"M√©dia"`.</li>
                <li>**Sen√£o:** Sa√≠da: `"Grande"`.</li>
              </ul>
            </li>
            <li>**Segmento Escolar (Tabela Clientes):**
              <p>
                Agrupando o n√≠vel de escolaridade para an√°lises (usando a coluna <code>Nivel Escolar</code>):
              </p>
              <ul>
                <li>**Regra 1:** Se `Nivel Escolar` `√© igual a` `"Fundamental"` ou `Nivel Escolar` `√© igual a` `"M√©dio"`
                  ‚Üí Sa√≠da: `"B√°sico"`.</li>
                <li>**Regra 2:** Se `Nivel Escolar` `√© igual a` `"Gradua√ß√£o"` ‚Üí Sa√≠da: `"Superior"`.</li>
                <li>**Sen√£o:** Sa√≠da: `"P√≥s-Gradua√ß√£o/Outro"`.</li>
              </ul>
            </li>
            <li>**Indicador Fim de Semana / Dia √ötil (Tabela Calend√°rio):**
              <ul>
                <li>**Regra:** Se `Dia da Semana N√∫mero` `√© maior ou igual a` `6` (S√°bado) ‚Üí Sa√≠da: `"Fim de Semana"`.
                </li>
                <li>**Sen√£o:** Sa√≠da: `"Dia √ötil"`.</li>
              </ul>
            </li>
          </ul>
        </div>
      </section>

      <section class="sub-section" id="calculo-idade-pq">
        <h2>4. Power Query Al√©m do Calend√°rio: Calculando Tempo e Idade</h2>

        <p>
          O Power Query tamb√©m √© excelente para calcular o tempo decorrido entre duas datas, como a idade de um cliente
          ou o tempo de servi√ßo de um funcion√°rio.
        </p>

        <div class="card">
          <h4>4.1. Calculando a Idade (Transformando Dura√ß√£o em Anos)</h4>
          <p>
            Se voc√™ tem uma tabela `Cadastro de Clientes` com a coluna `Data de Nascimento`, o c√°lculo de idade √© feito
            em tr√™s etapas no Power Query:
          </p>

          <h5>Passo 1: Gerar a Dura√ß√£o (`Idade`)</h5>
          <p>
            Selecione a coluna **Data de Nascimento**, v√° na guia **Adicionar Coluna ‚Üí Data ‚Üí Idade**.
            O Power Query gera uma nova coluna com o tempo decorrido da data de nascimento at√© o momento da atualiza√ß√£o,
            no formato **Dura√ß√£o** (dias, horas, minutos...).
          </p>

          <h5>Passo 2: Converter Dura√ß√£o para Total de Anos</h5>
          <p>
            Com a nova coluna de **Idade** selecionada, v√° na guia **Transformar ‚Üí Dura√ß√£o ‚Üí Total de Anos**.
            Isso converte o valor de dura√ß√£o para um n√∫mero decimal que representa a idade exata.
          </p>

          <h5>Passo 3: Arredondamento para Baixo</h5>
          <p>
            Uma pessoa s√≥ completa o ano de idade no dia do seu anivers√°rio. Portanto, precisamos descartar as casas
            decimais.
            Com a coluna ainda selecionada, v√° em **Transformar ‚Üí Arredondamento ‚Üí Arredondar para Baixo**.
            O resultado final √© a idade exata do cliente em anos inteiros.
          </p>
        </div>

        <div class="card">
          <h4>4.2. Outras Aplica√ß√µes de C√°lculo de Tempo no Power Query</h4>
          <p>A l√≥gica de Dura√ß√£o e Datas permite calcular m√©tricas temporais cruciais:</p>
          <ul>
            <li>**Tempo de Empresa:** Diferen√ßa entre a `Data de Admiss√£o` e a data atual.</li>
            <li>**Tempo de Cliente:** Diferen√ßa entre a `Data do Primeiro Pedido` e a data atual (√∫til para an√°lise de
              longevidade e fidelidade).</li>
            <li>**Ciclo de Pedido:** Tempo entre a `Data do Pedido` e a `Data de Entrega` (para medir efici√™ncia
              log√≠stica).</li>
            <li>**Idade M√©dia de Estoque:** Tempo entre a `Data de Entrada no Estoque` e a data atual (para identificar
              itens obsoletos ou de baixa rotatividade).</li>
          </ul>
        </div>
      </section>

      <section class="sub-section" id="pq-parametros">
        <h2>5. Otimizando a Conex√£o: Par√¢metros no Power Query</h2>

        <p>
          Ao importar dados de arquivos locais (como Excel ou CSV), o Power BI registra o **caminho absoluto** do seu
          arquivo. Isso causa um grande problema de manuten√ß√£o: se voc√™ mover a pasta do projeto, ou se outra pessoa
          abrir o arquivo em um computador com um caminho diferente, todas as fontes de dados falhar√£o.
        </p>
        <p>
          A solu√ß√£o profissional para isso √© utilizar **Par√¢metros**, que agem como vari√°veis globais no Power Query,
          tornando a gest√£o das conex√µes centralizada e din√¢mica.
        </p>

        <div class="card">
          <h4>Passo 1: Criando o Par√¢metro 'Caminho'</h4>
          <p>
            Vamos criar o par√¢metro <code>Caminho</code>, que armazenar√° a pasta principal onde est√£o localizados todos
            os arquivos Excel (Clientes, Produtos, Lojas, etc.).
          </p>
          <ol>
            <li>No Power Query, v√° para a guia **P√°gina Inicial**.</li>
            <li>No grupo **Par√¢metros**, clique em **Gerenciar Par√¢metros** -> **Novo Par√¢metro** .</li>
            <li>Defina os detalhes:
              <ul>
                <li>**Nome:** `Caminho`</li>
                <li>**Tipo Obrigat√≥rio:** `Texto`</li>
                <li>**Valor Atual:** Insira o caminho completo da sua pasta principal, **incluindo a barra invertida
                  final** (`\`), por exemplo: `C:\Users\felip\OneDrive\Documentos\aula_Power_BI\documentos\`</li>
              </ul>
            </li>
          </ol>
        </div>

        <div class="card">
          <h4>Passo 2: Usando o Par√¢metro nas Fontes de Dados (Linguagem M)</h4>
          <p>
            Originalmente, sua consulta de Clientes iniciava assim, com o caminho *hardcoded* (escrito diretamente):
          </p>
          <pre><code class="language-powershell">
let
    Fonte = Excel.Workbook(File.Contents("C:\Users\felip\OneDrive\Documentos\aula_Power_BI\documentos\Cadastro Clientes.xlsx"), null, true),
    // ...
          </code></pre>

          <p>
            Agora, vamos deletar o caminho completo e usar o par√¢metro <code>Caminho</code>. Na Linguagem M, o operador
            para **concatenar** (juntar) textos √© o **e comercial** (`&`).
          </p>

          <p>
            Voc√™ pode fazer isso no Editor Avan√ßado, ou clicando na etapa `Fonte` e editando a barra de f√≥rmulas:
          </p>

          <pre><code class="language-powershell">
let
    // O Power Query ir√° juntar: Par√¢metro & "Nome do Arquivo"
    Fonte = Excel.Workbook(File.Contents(Caminho & "Cadastro Clientes.xlsx"), null, true),
    Plan1_Sheet = Fonte{[Item="Plan1",Kind="Sheet"]}[Data],
    // ... (Restante do c√≥digo M) ...
          </code></pre>
        </div>

        <div class="card">
          <h4>Benef√≠cio: Portabilidade e Manuten√ß√£o Centralizada</h4>
          <p>
            Se o caminho for alterado, voc√™ s√≥ precisa ir em **Gerenciar Par√¢metros** e atualizar o valor do par√¢metro
            <code>Caminho</code> uma √∫nica vez. Todas as tabelas que usam o par√¢metro ser√£o corrigidas automaticamente,
            eliminando a necessidade de atualizar a fonte de dados em cada uma delas (Clientes, Produtos, Lojas, etc.).
          </p>
        </div>
      </section>

      <section class="exercise">
        <h2>Exerc√≠cio ‚Äì Crie sua primeira Tabela Calend√°rio profissional</h2>
        <p>
          Baseado no que vimos at√© aqui, fa√ßa o seguinte no seu arquivo do Power BI:
        </p>
        <ol>
          <li>Criar uma tabela calend√°rio via DAX baseada em <code>BaseVendas[Data da Venda]</code>.</li>
          <li>Adicionar colunas: Ano, M√™s n√∫mero, Nome do m√™s, Ano-M√™s, Dia, Dia da Semana, √â Fim de Semana.</li>
          <li>Marcar a tabela como ‚ÄúTabela de Data‚Äù e ajustar os relacionamentos.</li>
          <li>
            Criar um gr√°fico de linha com <strong>Calendario[AnoMesTexto]</strong> no eixo
            e uma medida de vendas no valor.
          </li>
        </ol>

        <button class="toggle-answer-btn">Mostrar sugest√£o de resposta</button>
        <div class="answer">
          <p>Um exemplo de script de calend√°rio via DAX seria:</p>
          <pre><code class="language-dax">
Calendario =
VAR MinData =
    MIN ( BaseVendas[Data da Venda] )
VAR MaxData =
    MAX ( BaseVendas[Data da Venda] )
RETURN
ADDCOLUMNS (
    CALENDAR ( MinData, MaxData ),
    "Ano", YEAR ( [Date] ),
    "MesNumero", MONTH ( [Date] ),
    "MesNome", FORMAT ( [Date], "mmmm" ),
    "Dia", DAY ( [Date] ),
    "DiaSemanaNumero", WEEKDAY ( [Date], 2 ),
    "DiaSemanaNome", FORMAT ( [Date], "dddd" ),
    "AnoMesNumero", YEAR ( [Date] ) * 100 + MONTH ( [Date] ),
    "AnoMesTexto", FORMAT ( [Date], "YYYY-MM" ),
    "MesAnoTexto", FORMAT ( [Date], "MMMM/YYYY" ),
    "EhFimDeSemana", IF ( WEEKDAY ( [Date], 2 ) > 5, 1, 0 ),
    "EhDiaUtil", IF ( WEEKDAY ( [Date], 2 ) <= 5, 1, 0 )
)
          </code></pre>

          <p>
            Depois disso, marque a tabela como <strong>Tabela de Data</strong>,
            relacione <code>Calendario[Date]</code> com <code>BaseVendas[Data da Venda]</code>
            e use <code>AnoMesTexto</code> + <code>AnoMesNumero</code> para ordenar os gr√°ficos.
          </p>
        </div>
      </section>



      <section class="thought-of-the-day" id="thought-of-the-day">
        Carregando pensamento do dia...
      </section>
    </main>

    <a href="#top" class="back-to-top" id="back-to-top">‚Üë</a>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-..."
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-dax.min.js" integrity="sha512-..."
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-powershell.min.js"
    integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script src="quotes.js"></script>
  <script src="js/main.js"></script>
</body>

</html>